"use strict";function embedYTApi(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function onYouTubeIframeAPIReady(){player=new YT.Player("player",{videoId:default_obra.video,playerVars:{disablekb:1,modestbranding:1,rel:0,showinfo:0},events:{onReady:onPlayerReady}})}function onPlayerReady(e){}function loadVideoByID(e){player.loadVideoById(e)}var SocialShare=SocialShare||{};$(document).ready(function(){!function(e){function t(e,t){if(!c[e])throw new Error("Share service not defined");return o(a(e,t)),this}function a(e,t){var a=c[e].shareurl,o=c[e].paramproto;return t=t||{},"facebook"===e?t.u?t.u=r+t.u:t.u=r:"twitter"===e||(t.url?t.url=r+t.url:t.url=r),"linkedin"===e&&(t.mini&&"true"===t.mini||(t.mini="true")),n(a,i(t,o))}function i(e,t){var a=[];e=e||{};for(var i in e)if(t.hasOwnProperty(i)){var n=t[i]+encodeURIComponent(e[i]);a.push(n)}return a}function n(e,t){return t=t||[],t.length?e+t.join("&"):e}function o(e){var t=($(window).height()-600)/2,a=($(window).width()-600)/2,i="status=1,width=600,height=600,top="+t+",left="+a,n=e;return window.open(n,"_blank",i),!1}var r=window.location.href,c={twitter:{shareurl:"http://twitter.com/intent/tweet?",paramproto:{text:"text=",url:"url=",hashtags:"hashtags=",via:"via=",related:"related="}},facebook:{shareurl:"http://www.facebook.com/sharer.php?",paramproto:{u:"u="}},linkedin:{shareurl:"http://www.linkedin.com/shareArticle?",paramproto:{url:"url=",mini:"mini=",title:"title=",summary:"summary=",source:"source="}},googleplus:{shareurl:"https://plus.google.com/share?",paramproto:{url:"url=",hl:"hl="}}};!function(){function e(e,t){return t=$.map(t,function(t,a){return e+"-"+t}),function(e){if(e){return $.map(t,function(e,t){return"."+e}).join(", ")}return t}}function a(e){function a(e){return $(this).hasClass(e)}var i=Array.prototype.slice.call($(this)[0].attributes),o={};$.each(i,function(e,t){var a=t.name,i=t.value;if(0===a.indexOf(n+"-")||0===a.indexOf("data-"+n+"-")){var r=a.split(n+"-")[1];o[r]=i}});var c=r.filter(a.bind(this));if(1===c.length){t(c[0].split("-")[1],o)}}var i=Object.keys(c),n="share",o=e(n,i)(!0),r=e(n,i)(!1);$(o).on("click",a)}();var s={share:t};e=$.extend(e,s)}(SocialShare)});var default_obra_id=10,default_obra,player,api_flag=!1,data_flag=!1,streetview_key="AIzaSyCeSxDOvim56tGJFPPx4pVZOry12AnDc-I",InundacionesLp=Vue.extend({data:function(){return{selected:"",loading:!1,via:!1}},computed:{},watch:{selected:function(e){var t=this;"map"==this.via?this.via=!1:_.forEach(this.markers,function(a){a.options.id==e.id?(a.openPopup(),t.map.panTo(a._latlng)):a.closePopup()}),this.updateChart(),this.updateCarousel(),this.updateBlocks(),this.updateVideo()}},methods:{updateBlocks:function(){setTimeout(function(){$(".grupo3").matchHeight()},500)},updateVideo:function(){player&&loadVideoByID(this.selected.video)},updateCarousel:function(){setTimeout(function(){$(".carousel-inner .item").removeClass("active").first().addClass("active"),$(".carousel-indicators li").removeClass("active").first().addClass("active")},1e3)},updateChart:function(){var e=this;setTimeout(function(){e.avance_chart?e.avance_chart.load({json:e.selected.chart_data,keys:{x:"fecha",value:["cumplimiento","meta"]}}):e.avance_chart=c3.generate({bindto:"#avance-chart",size:{height:250},data:{json:e.selected.chart_data,keys:{x:"fecha",value:["cumplimiento","meta"]},type:"line",colors:{cumplimiento:"#B852DE",meta:"#5702A7"},names:{cumplimiento:"Cumplimiento",meta:"Meta"}},line:{connectNull:!0},padding:{left:50,right:30,top:20,bottom:10},axis:{x:{type:"timeseries",tick:{format:function(t){return e.months[t.getMonth()]+"-"+t.getFullYear()},count:3}},y:{min:0,max:100,tick:{format:function(e){return e+"%"},values:[0,50,100]}}}})},500)},dataLoaded:function(e){e=e.OBRAS.elements,data_flag=!0,this.loading=!1,this.obras=e.map(function(e){if(e.images=[],e.imagen_1&&e.images.push(e.imagen_1),e.imagen_2&&e.images.push(e.imagen_2),e.imagen_3&&e.images.push(e.imagen_3),0==e.images.length){var t="https://maps.googleapis.com/maps/api/streetview?size=400x400&location="+e.lat+","+e.lng+"&key="+streetview_key+"&heading=";e.images.push(t+"0"),e.images.push(t+"90"),e.images.push(t+"180"),e.images.push(t+"270")}if(e.chart_data=[],e.chart_data_grid=[],e.fecha_inicio&&e.plazo_de_obra_en_dias&&(e.fecha_inicio_moment=moment(e.fecha_inicio.trim(),"DD/MM/YYYY"),e.fecha_fin_moment=moment(e.fecha_inicio.trim(),"DD/MM/YYYY").add(e.plazo_de_obra_en_dias,"days"),e.chart_data.push({fecha:e.fecha_inicio_moment.format("YYYY-MM-DD"),meta:0,cumplimiento:0}),e.chart_data.push({fecha:e.fecha_fin_moment.format("YYYY-MM-DD"),meta:100,cumplimiento:null}),e.chart_data_grid.push({value:e.fecha_fin_moment.format("YYYY-MM-DD"),text:"Fecha l√≠mite",position:"middle"})),e.p_2014_12&&(!e.fecha_inicio_moment||e.fecha_inicio_moment.format("YYYY-MM-DD")<"2014-12-01")&&e.chart_data.push({fecha:"2014-12-01",meta:null,cumplimiento:e.p_2014_12}),e.p_2015_07&&(!e.fecha_inicio_moment||e.fecha_inicio_moment.format("YYYY-MM-DD")<"2015-07-01")&&e.chart_data.push({fecha:"2015-07-01",meta:null,cumplimiento:e.p_2015_07}),e.p_2015_12&&(!e.fecha_inicio_moment||e.fecha_inicio_moment.format("YYYY-MM-DD")<"2015-12-01")&&e.chart_data.push({fecha:"2015-12-01",meta:null,cumplimiento:e.p_2015_12}),e.p_2016_07&&(!e.fecha_inicio_moment||e.fecha_inicio_moment.format("YYYY-MM-DD")<"2016-07-01")&&e.chart_data.push({fecha:"2016-07-01",meta:null,cumplimiento:e.p_2016_07}),e.p_2016_09&&(!e.fecha_inicio_moment||e.fecha_inicio_moment.format("YYYY-MM-DD")<"2016-09-01")&&e.chart_data.push({fecha:"2016-09-01",meta:null,cumplimiento:e.p_2016_09}),e.p_2016_11){var a=e.fecha_fin_moment&&e.fecha_fin_moment.format("YYYY-MM-DD")<"2016-11-01"?100:null;e.chart_data.push({fecha:"2016-11-01",meta:a,cumplimiento:e.p_2016_11})}return e}),default_obra=_.first(this.obras.filter(function(e){return e.id==default_obra_id})),this.selected=default_obra,this.createMap(),embedYTApi()},createMap:function(){var e=this;this.map=L.map("mapa").setView([-34.9314,-57.9489],15),this.map.scrollWheelZoom.disable(),L.tileLayer("http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19}).addTo(this.map);var t=L.CircleMarker.extend({options:{id:"pala"}});this.obras.forEach(function(a){a.lat&&a.lng&&(a.color="#B852DE",e.markers.push(new t([a.lat,a.lng],a).bindPopup(a.nombre).on("click",function(t,a){var i=$(t.srcElement||t.target);e.via="map",e.selected=i[0].options}).addTo(e.map)))})}},created:function(){this.selected="",this.loading=!0,this.markers=[],this.months=["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"],Tabletop.init({key:"1PuXOuYNb0z6btfCx6ANYxHxTWjgQyPKUCVR7et2zs1o",callback:this.dataLoaded,simpleSheet:!1,parseNumbers:!0})},ready:function(){}});Vue.config.warnExpressionErrors=!0,Vue.config.debug=!0,new Vue({el:"#app",components:{"inundaciones-lp":InundacionesLp},created:function(){this.pymChild=pym.Child({polling:500})},ready:function(){}});