"use strict";var InundacionesLp=Vue.extend({data:function(){return{selected:"",loading:!1,via:!1}},computed:{},watch:{selected:function(a){var e=this;"map"==this.via?this.via=!1:_.forEach(this.markers,function(t){t.options.id==a.id?(t.openPopup(),e.map.panTo(t._latlng)):t.closePopup()}),this.updateChart()}},methods:{updateChart:function(){var a=this;a.avance_chart?(console.log("update!",a.selected.chart_data),a.avance_chart.load({json:a.selected.chart_data})):setTimeout(function(){a.avance_chart=c3.generate({bindto:"#avance-chart",size:{height:300},data:{json:a.selected.chart_data,keys:{x:"fecha",value:["cumplimiento","meta"]},type:"spline"},line:{connectNull:!0},axis:{x:{type:"timeseries",tick:{format:function(a){return a.getFullYear()+"-"+a.getMonth()}}},y:{min:0}}})},1e3)},dataLoaded:function(a){this.loading=!1,this.obras=a.map(function(a){return a.images=[],a.imagen_1&&a.images.push(a.imagen_1),a.imagen_2&&a.images.push(a.imagen_2),a.imagen_3&&a.images.push(a.imagen_3),a.chart_data=[],a.fecha_inicio&&a.plazo_de_obra_en_dias&&(a.fecha_inicio=moment(a.fecha_inicio,"DD/MM/YYYY"),a.fecha_fin=moment(a.fecha_inicio,"DD/MM/YYYY").add(a.plazo_de_obra_en_dias,"days").format("YYYY-MM-DD"),console.log(a.plazo_de_obra_en_dias),console.log(a.fecha_inicio),console.log(a.fecha_fin),a.chart_data.push({fecha:a.fecha_inicio.format("YYYY-MM-DD"),meta:0,cumplimiento:0}),a.chart_data.push({fecha:a.fecha_fin,meta:100,cumplimiento:null})),a.p_2014_12&&a.chart_data.push({fecha:"2014-12-01",meta:null,cumplimiento:a.p_2014_12}),a.p_2015_07&&a.chart_data.push({fecha:"2015-07-01",meta:null,cumplimiento:a.p_2015_07}),a.p_2015_12&&a.chart_data.push({fecha:"2015-12-01",meta:null,cumplimiento:a.p_2015_12}),a.p_2016_07&&a.chart_data.push({fecha:"2016-07-01",meta:null,cumplimiento:a.p_2016_07}),a.p_2016_09&&a.chart_data.push({fecha:"2016-09-01",meta:a.fecha_fin>"2016-09-01"?100:null,cumplimiento:a.p_2016_09}),a}).sort(function(a,e){return a.nombre.trim().toLowerCase()>=e.nombre.trim().toLowerCase()?1:-1}),this.createMap(),console.log(a)},createMap:function(){var a=this;this.map=L.map("mapa").setView([-34.9314,-57.9489],11),this.map.scrollWheelZoom.disable(),L.tileLayer("http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19}).addTo(this.map);var e=L.CircleMarker.extend({options:{id:"pala"}});this.obras.forEach(function(t){t.lat&&t.lng&&a.markers.push(new e([t.lat,t.lng],t).bindPopup(t.nombre).on("click",function(e,t){var n=$(e.srcElement||e.target);a.via="map",a.selected=n[0].options}).addTo(a.map))})}},created:function(){console.log("created component!"),this.loading=!0,this.markers=[],Tabletop.init({key:"1PuXOuYNb0z6btfCx6ANYxHxTWjgQyPKUCVR7et2zs1o",callback:this.dataLoaded,simpleSheet:!0,parseNumbers:!0})},ready:function(){console.log("ready component!")}});Vue.config.warnExpressionErrors=!0,Vue.config.debug=!0,new Vue({el:"#app",components:{"inundaciones-lp":InundacionesLp},created:function(){console.log("created app!"),this.pymChild=pym.Child({polling:500})},ready:function(){console.log("ready app!")}});